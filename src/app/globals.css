@tailwind base;
@tailwind components;
@tailwind utilities;

/* Base */
@layer base {
  * { @apply border-border; }
  body {
    @apply bg-background text-foreground antialiased;
    font-feature-settings: "rlig" 1, "calt" 1;
  }
}

::selection { background-color: rgb(4, 47, 46); color: rgb(45, 212, 191); }
::-moz-selection { background-color: rgb(4, 47, 46); color: rgb(45, 212, 191); }

html {
  scroll-behavior: smooth;
  overflow-y: scroll;
}

/* Theme tokens */
@layer base {
:root {
    --background: 0 0% 100%;
    --foreground: 0 0% 0%;
    --card: 0 0% 100%;
    --card-foreground: 0 0% 0%;
    --popover: 0 0% 100%;
    --popover-foreground: 0 0% 0%;
    --primary: 0 0% 0%;
    --primary-foreground: 0 0% 100%;
    --secondary: 0 0% 96.1%;
    --secondary-foreground: 0 0% 0%;
    --muted: 0 0% 96.1%;
    --muted-foreground: 0 0% 45.1%;
    --accent: 0 0% 96.1%;
    --accent-foreground: 0 0% 0%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 0 0% 98%;
    --border: 0 0% 89.8%;
    --input: 0 0% 89.8%;
    --ring: 0 0% 0%;
    --radius: 0.5rem;
    --theme-transition-duration: 120ms;
    --theme-transition-easing: cubic-bezier(0.4, 0.0, 0.2, 1);
    --glass-blur-base: 10px;
    --glass-blur-hover: 12px;
    --glass-blur-readable: 4px;
    --glass-opacity-base: 0.62;
    --glass-opacity-hover: 0.68;
    --glass-opacity-readable: 0.88;
    --glass-saturation: 1.05;
    --glass-edge-highlight: 0.38;
    --glass-inner-shadow: 0.08;
    --glass-drop-shadow: 0.12;
  }

  .dark {
    --background: 0 0% 0%;
    --foreground: 0 0% 100%;
    --card: 0 0% 0%;
    --card-foreground: 0 0% 100%;
    --popover: 0 0% 0%;
    --popover-foreground: 0 0% 100%;
    --primary: 0 0% 100%;
    --primary-foreground: 0 0% 0%;
    --secondary: 0 0% 14.9%;
    --secondary-foreground: 0 0% 100%;
    --muted: 0 0% 14.9%;
    --muted-foreground: 0 0% 63.9%;
    --accent: 0 0% 14.9%;
    --accent-foreground: 0 0% 100%;
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 0 0% 100%;
    --border: 0 0% 14.9%;
    --input: 0 0% 14.9%;
    --ring: 0 0% 100%;
    --glass-opacity-base: 0.4;
    --glass-opacity-hover: 0.46;
    --glass-opacity-readable: 0.78;
    --glass-edge-highlight: 0.2;
    --glass-inner-shadow: 0.38;
    --glass-drop-shadow: 0.36;
  }

  .sepia {
    /* Stronger sepia background for better contrast */
    --background: 40 25% 92%;
    --foreground: 0 0% 10%;
    /* Pure white cards for maximum contrast */
    --card: 0 0% 100%;
    --card-foreground: 0 0% 10%;
    --popover: 0 0% 100%;
    --popover-foreground: 0 0% 10%;
    --primary: 0 0% 10%;
    --primary-foreground: 0 0% 98%;
    --secondary: 0 0% 96.1%;
    --secondary-foreground: 0 0% 10%;
    --muted: 0 0% 94%;
    --muted-foreground: 0 0% 40%;
    --accent: 0 0% 96.1%;
    --accent-foreground: 0 0% 10%;
    --destructive: 0 62.8% 45%;
    --destructive-foreground: 0 0% 98%;
    --border: 0 0% 85%;
    --input: 0 0% 96%;
    --ring: 0 0% 20%;
    /* Glass effect settings for better card visibility */
    --glass-opacity-base: 0.75;
    --glass-opacity-hover: 0.82;
    --glass-opacity-readable: 0.95;
    --glass-edge-highlight: 0.5;
    --glass-inner-shadow: 0.05;
    --glass-drop-shadow: 0.2;
  }
}

/* Quran fonts from Quran Foundation
 * Documentation: https://api-docs.quran.foundation/docs/tutorials/fonts/font-rendering/
 */

/* Uthmanic Hafs - Standard Uthmani script */
@font-face {
  font-family: "Uthmanic Hafs";
  src:
    url("/fonts/UthmanicHafs1Ver18.woff2") format("woff2"),
    url("/fonts/UthmanicHafs1Ver18.ttf") format("truetype");
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

/* IndoPak Nastaleeq - South Asian script style */
@font-face {
  font-family: "IndoPak Nastaleeq";
  src:
    url("/fonts/indopak-nastaleeq.woff2") format("woff2"),
    url("/fonts/indopak-nastaleeq.ttf") format("truetype");
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

/* Font utility classes */
.font-quran {
  font-family: "Uthmanic Hafs", "Traditional Arabic", "Arabic Typesetting", "Geeza Pro", var(--font-geist-sans), system-ui, sans-serif;
}

.font-quran-indopak {
  font-family: "IndoPak Nastaleeq", "Noto Nastaliq Urdu", "Traditional Arabic", "Arabic Typesetting", var(--font-geist-sans), system-ui, sans-serif;
}

.font-quran-tajweed {
  /* TODO: Implement Tajweed V4 with colored glyphs (FUTURE FEATURE)
   *
   * The colored Tajweed implementation requires:
   * 1. Page-specific fonts (p1-p604) - one font file per Quran page
   * 2. Dynamic font loading based on current page/surah
   * 3. COLRv1 format fonts for Chrome/Safari/Edge
   * 4. OT-SVG format fonts for Firefox with theme variants (Light/Dark/Sepia)
   *
   * Font URL pattern:
   * https://verses.quran.foundation/fonts/quran/hafs/v4/colrv1/woff2/p{PAGE}.woff2
   *
   * Implementation approach:
   * - Determine which page a surah/ayah is on
   * - Dynamically inject @font-face for that specific page
   * - Apply colored Tajweed rules (ikhfa, qalqalah, ghunnah, etc.) via font glyphs
   *
   * For now, falls back to standard Uthmanic Hafs font
   */
  font-family: "Uthmanic Hafs", "Traditional Arabic", "Arabic Typesetting", var(--font-geist-sans), system-ui, sans-serif;
}

/* Active ayah highlight (audio-playing) */
[data-active-ayah="1"],
.active-ayah {
  outline: 2px solid hsl(174 100% 29% / 0.9);
  outline-offset: 2px;
  background: color-mix(in oklab, transparent 90%, #0ea5a2 10%);
  transition: background 120ms linear, outline-color 120ms linear;
}

/* Smooth theme transitions - applied directly to root for consistency */
html {
  transition: background-color var(--theme-transition-duration) var(--theme-transition-easing);
}

body {
  transition: background-color var(--theme-transition-duration) var(--theme-transition-easing),
              color var(--theme-transition-duration) var(--theme-transition-easing);
}

/* Apply smooth transitions to common elements */
* {
  transition: background-color var(--theme-transition-duration) var(--theme-transition-easing),
              border-color var(--theme-transition-duration) var(--theme-transition-easing),
              color var(--theme-transition-duration) var(--theme-transition-easing);
}

.sepia h1,
.sepia h2,
.sepia h3,
.sepia h4,
.sepia h5,
.sepia h6 {
  color: hsl(var(--primary));
}

.mode-toggle-icon {
  color: hsl(var(--foreground));
  opacity: 0.78;
  transition: color var(--theme-transition-duration) var(--theme-transition-easing),
              opacity var(--theme-transition-duration) var(--theme-transition-easing),
              fill var(--theme-transition-duration) var(--theme-transition-easing),
              stroke var(--theme-transition-duration) var(--theme-transition-easing);
}

.sepia .mode-toggle-icon {
  color: hsl(var(--primary));
  opacity: 0.82;
}

.mode-toggle-button {
  transition: background-color var(--theme-transition-duration) var(--theme-transition-easing),
              border-color var(--theme-transition-duration) var(--theme-transition-easing),
              color var(--theme-transition-duration) var(--theme-transition-easing);
}

/* Respect reduced motion preference */
@media (prefers-reduced-motion: reduce) {
  html, body, * {
    transition: none !important;
  }
}

/* Pastel bookmark tints (audio highlight takes precedence) */
article[data-bookmark="p1"]:not([data-active-ayah="1"]) {
  background: color-mix(in oklab, transparent 90%, #34d399 10%); /* emerald */
  outline: 1px solid color-mix(in oklab, #34d399 35%, transparent);
}
article[data-bookmark="p2"]:not([data-active-ayah="1"]) {
  background: color-mix(in oklab, transparent 90%, #38bdf8 10%); /* sky */
  outline: 1px solid color-mix(in oklab, #38bdf8 35%, transparent);
}
article[data-bookmark="p3"]:not([data-active-ayah="1"]) {
  background: color-mix(in oklab, transparent 90%, #fbbf24 12%); /* amber */
  outline: 1px solid color-mix(in oklab, #fbbf24 40%, transparent);
}
article[data-bookmark="p4"]:not([data-active-ayah="1"]) {
  background: color-mix(in oklab, transparent 90%, #fb7185 10%); /* rose */
  outline: 1px solid color-mix(in oklab, #fb7185 35%, transparent);
}
article[data-bookmark="p5"]:not([data-active-ayah="1"]) {
  background: color-mix(in oklab, transparent 90%, #a78bfa 10%); /* violet */
  outline: 1px solid color-mix(in oklab, #a78bfa 35%, transparent);
}

/* Scrollbar is always visible via overflow-y: scroll on html element above */

/* Prevent Radix UI from modifying body styles when dropdown/dialog opens */
body {
  overflow-y: auto !important;
  margin-right: 0 !important;
  padding-right: 0 !important;
}

body[data-scroll-locked],
body[style*="pointer-events"],
body[style*="overflow"],
body[style*="padding-right"],
body[style*="margin-right"] {
  overflow-y: auto !important;
  margin-right: 0 !important;
  padding-right: 0 !important;
  pointer-events: auto !important;
}

/* Smooth fade-in animation for grid items */
@keyframes fade-in {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

.animate-fade-in {
  animation: fade-in 0.4s ease-out forwards;
  animation-fill-mode: both;
}

/* Smooth slide-down animation for navigation */
@keyframes slide-down {
  from {
    opacity: 0;
    transform: translateY(-8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-slide-down {
  animation: slide-down 0.3s ease-out forwards;
}

@layer components {
  .glass-surface {
    --glass-blur: var(--glass-blur-base);
    --glass-opacity: var(--glass-opacity-base);
    background-color: hsl(var(--background) / var(--glass-opacity));
    backdrop-filter: blur(var(--glass-blur)) saturate(var(--glass-saturation));
    -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(var(--glass-saturation));
    box-shadow:
      inset 0 1px 0 hsl(0 0% 100% / var(--glass-edge-highlight)),
      inset 0 -1px 2px hsl(0 0% 0% / var(--glass-inner-shadow)),
      0 10px 24px hsl(0 0% 0% / var(--glass-drop-shadow));
    transition:
      opacity var(--theme-transition-duration) var(--theme-transition-easing),
      transform var(--theme-transition-duration) var(--theme-transition-easing),
      backdrop-filter var(--theme-transition-duration) var(--theme-transition-easing),
      background-color var(--theme-transition-duration) var(--theme-transition-easing),
      box-shadow var(--theme-transition-duration) var(--theme-transition-easing);
  }

  @supports ((-webkit-backdrop-filter: blur(1px)) or (backdrop-filter: blur(1px))) {
    .glass-surface {
      background-color: hsl(var(--background) / calc(var(--glass-opacity) - 0.06));
    }
  }

  .glass-readable {
    --glass-blur: var(--glass-blur-readable);
    --glass-opacity: var(--glass-opacity-readable);
  }

  .glass-interactive {
    will-change: transform, opacity, backdrop-filter;
  }

  .glass-interactive:hover {
    --glass-opacity: var(--glass-opacity-hover);
    --glass-blur: var(--glass-blur-hover);
    transform: translateY(-1px);
  }

  .glass-sheet {
    box-shadow:
      inset 0 1px 0 hsl(0 0% 100% / var(--glass-edge-highlight)),
      inset 0 -1px 2px hsl(0 0% 0% / var(--glass-inner-shadow));
  }
}

/* COLRv1 Font Palette Support for Tajweed Fonts
 * Controls color scheme of COLRv1 fonts based on theme
 * Reference: https://css-tricks.com/colrv1-and-css-font-palette-web-typography/
 */
@layer base {
  /* Apply font-palette to COLRv1 Tajweed fonts - use normal (default embedded colors) */
  .tajweed-colrv1 {
    font-palette: normal;
    /* Prevent color inheritance from affecting COLRv1 glyph colors */
    -webkit-text-fill-color: initial;
  }

  /* Light mode - default colors from font (no filters) */
  :root .tajweed-colrv1 {
    filter: none;
  }

  /* Dark mode - invert lightness, rotate hue back, boost saturation */
  .dark .tajweed-colrv1 {
    filter: invert(1) hue-rotate(180deg) saturate(1.2);
  }

  /* Sepia mode - boost saturation to compensate for warm background perception */
  .sepia .tajweed-colrv1 {
    filter: saturate(1.3) contrast(1.05);
  }
}
